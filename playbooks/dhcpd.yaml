- name: DHCP Server
  hosts: all
  tasks:

    - name: Install
      ansible.builtin.apt:
        pkg:
          - udhcpd

    - name: Systemd Unit
      ansible.builtin.copy:
        src: ./files/etc/init.d/udhcpd
        dest: /etc/init.d/udhcpd
        backup: yes
      notify:
        - Systemd Reload

    - name: Enable
      ansible.builtin.copy:
        src: ./files/etc/default/udhcpd
        dest: /etc/default/udhcpd
        backup: yes
      notify:
        - Service

    - name: Config
      ansible.builtin.template:
        src: ./files/etc/udhcpd.conf
        dest: /etc/udhcpd.conf
        backup: yes
      notify:
        - Service

  handlers:

    - name: Systemd Reload
      ansible.builtin.command:
        cmd: systemctl daemon-reload

    - name: Service
      ansible.builtin.service:
        name: udhcpd
        enabled: yes
        state: restarted
